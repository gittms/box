//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30128.1
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using Definitif;
using Definitif.Data;
using Definitif.Data.ObjectSql;
using Definitif.Data.ObjectSql.Query;
using System;
using System.Collections.Generic;
using System.Data;


namespace Definitif.Test {
    
    public partial class User : Model<Definitif.Test.Mappers.User> {

        /// <summary>
        /// Gets User instance from database by given Id.
        /// </summary>
        public User Get(Id id) {
            return User.Mapper.Get(id);
        }

        public string Name {
            get { return p_name; }
            set { p_name = value; }
        }
        protected string p_name;

    }
    public partial class Achivement : Model<Definitif.Test.Mappers.Achivement> {

        /// <summary>
        /// Gets Achivement instance from database by given Id.
        /// </summary>
        public Achivement Get(Id id) {
            return Achivement.Mapper.Get(id);
        }

        public string Name {
            get { return p_name; }
            set { p_name = value; }
        }
        protected string p_name;

    }
    public partial class UserAchivement : Model<Definitif.Test.Mappers.UserAchivement>, IManyToMany {

        /// <summary>
        /// Gets UserAchivement instance from database by given Id.
        /// </summary>
        public UserAchivement Get(Id id) {
            return UserAchivement.Mapper.Get(id);
        }

        protected Id UserId {
            get { return id_user; }
            set { id_user = value; }
        }
        protected Id id_user = Id.Empty;

        public User User {
            get {
                if (p_user == null && id_user != Id.Empty) {
                    p_user = User.Get(id_user);
                }
                return p_user;
            }
            set {
                p_user = value;
                id_user = value.Id;
            }
        }
        protected User p_user = null;

        protected Id AchivementId {
            get { return id_achivement; }
            set { id_achivement = value; }
        }
        protected Id id_achivement = Id.Empty;

        public Achivement Achivement {
            get {
                if (p_achivement == null && id_achivement != Id.Empty) {
                    p_achivement = Achivement.Get(id_achivement);
                }
                return p_achivement;
            }
            set {
                p_achivement = value;
                id_achivement = value.Id;
            }
        }
        protected Achivement p_achivement = null;

        public DateTime Received {
            get { return p_received; }
            set { p_received = value; }
        }
        protected DateTime p_received;

    }
    public partial class User {

        /// <summary>
        /// Gets linked Achivement objects.
        /// </summary>
        public List<ManyToMany<UserAchivement, Achivement>> GetAchivements() {
            return ManyToMany<UserAchivement, Achivement>.Mapper.Get(this.id);
        }

    }
    public partial class Achivement {

        /// <summary>
        /// Gets linked User objects.
        /// </summary>
        public List<ManyToMany<UserAchivement, User>> GetUsers() {
            return ManyToMany<UserAchivement, User>.Mapper.Get(this.id);
        }

    }
}
namespace Definitif.Test.Mappers {
    
    public partial class User : Mapper<Definitif.Test.User> {

        public User()
        {
            this.database = Core.Database;
            this.table = this.database["Users"];
        }

        public sealed override Definitif.Test.User ReadObject(IDataReader reader)
        {
            Definitif.Test.User result = new Definitif.Test.User()
            {
                Name = (string)reader["Name"],
            };
            FillBase(result, reader);
            return result;
        }
        public sealed override Definitif.Test.User ReadObject(IDataReader reader, string fieldPrefix)
        {
            Definitif.Test.User result = new Definitif.Test.User()
            {
                Name = (string)reader[fieldPrefix + "Name"],
            };
            FillBase(result, reader, fieldPrefix);
            return result;
        }

        protected sealed override List<IDbCommand> InsertCommands(Definitif.Test.User obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Insert() {
                        VALUES = {
                            table["Name"] == obj.Name,
                        }
                    })
            };
            this.InsertCommandsExtension(obj, list);
            return list;
        }
        partial void InsertCommandsExtension(Definitif.Test.User obj, List<IDbCommand> list);

        protected sealed override List<IDbCommand> UpdateCommands(Definitif.Test.User obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Insert() {
                        VALUES = {
                            table["Version"] == obj.Version + 1,
                            table["Name"] == obj.Name,
                        },
                        WHERE = {
                            table["Id"] == obj.Id.Value,
                            table["Version"] == obj.Version,
                        }
                    })
            };
            this.UpdateCommandsExtension(obj, list);
            return list;
        }
        partial void UpdateCommandsExtension(Definitif.Test.User obj, List<IDbCommand> list);

        protected sealed override List<IDbCommand> DeleteCommands(Definitif.Test.User obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Delete(table) {
                        WHERE = {
                            table["Id"] == obj.Id.Value, 
                            table["Version"] == obj.Version,
                        }
                    })
            };
            this.DeleteCommandsExtension(obj, list);
            return list;
        }
        partial void DeleteCommandsExtension(Definitif.Test.User obj, List<IDbCommand> list);

    }
    public partial class Achivement : Mapper<Definitif.Test.Achivement> {

        public Achivement()
        {
            this.database = Core.Database;
            this.table = this.database["Achivements"];
        }

        public sealed override Definitif.Test.Achivement ReadObject(IDataReader reader)
        {
            Definitif.Test.Achivement result = new Definitif.Test.Achivement()
            {
                Name = (string)reader["Name"],
            };
            FillBase(result, reader);
            return result;
        }
        public sealed override Definitif.Test.Achivement ReadObject(IDataReader reader, string fieldPrefix)
        {
            Definitif.Test.Achivement result = new Definitif.Test.Achivement()
            {
                Name = (string)reader[fieldPrefix + "Name"],
            };
            FillBase(result, reader, fieldPrefix);
            return result;
        }

        protected sealed override List<IDbCommand> InsertCommands(Definitif.Test.Achivement obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Insert() {
                        VALUES = {
                            table["Name"] == obj.Name,
                        }
                    })
            };
            this.InsertCommandsExtension(obj, list);
            return list;
        }
        partial void InsertCommandsExtension(Definitif.Test.Achivement obj, List<IDbCommand> list);

        protected sealed override List<IDbCommand> UpdateCommands(Definitif.Test.Achivement obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Insert() {
                        VALUES = {
                            table["Version"] == obj.Version + 1,
                            table["Name"] == obj.Name,
                        },
                        WHERE = {
                            table["Id"] == obj.Id.Value,
                            table["Version"] == obj.Version,
                        }
                    })
            };
            this.UpdateCommandsExtension(obj, list);
            return list;
        }
        partial void UpdateCommandsExtension(Definitif.Test.Achivement obj, List<IDbCommand> list);

        protected sealed override List<IDbCommand> DeleteCommands(Definitif.Test.Achivement obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Delete(table) {
                        WHERE = {
                            table["Id"] == obj.Id.Value, 
                            table["Version"] == obj.Version,
                        }
                    })
            };
            this.DeleteCommandsExtension(obj, list);
            return list;
        }
        partial void DeleteCommandsExtension(Definitif.Test.Achivement obj, List<IDbCommand> list);

    }
    public partial class UserAchivement : Mapper<Definitif.Test.UserAchivement>, IManyToManyMapper {

        public UserAchivement()
        {
            this.database = Core.Database;
            this.table = this.database["UserAchivements"];
        }

        public sealed override Definitif.Test.UserAchivement ReadObject(IDataReader reader)
        {
            Definitif.Test.UserAchivement result = new Definitif.Test.UserAchivement()
            {
                UserId = (reader["UserId"] == DBNull.Value) ? Id.Empty : new Id(reader["UserId"]),
                AchivementId = (reader["AchivementId"] == DBNull.Value) ? Id.Empty : new Id(reader["AchivementId"]),
                Received = (DateTime)reader["Received"],
            };
            FillBase(result, reader);
            return result;
        }
        public sealed override Definitif.Test.UserAchivement ReadObject(IDataReader reader, string fieldPrefix)
        {
            Definitif.Test.UserAchivement result = new Definitif.Test.UserAchivement()
            {
                UserId = (reader[fieldPrefix + "UserId"] == DBNull.Value) ? Id.Empty : new Id(reader[fieldPrefix + "UserId"]),
                AchivementId = (reader[fieldPrefix + "AchivementId"] == DBNull.Value) ? Id.Empty : new Id(reader[fieldPrefix + "AchivementId"]),
                Received = (DateTime)reader[fieldPrefix + "Received"],
            };
            FillBase(result, reader, fieldPrefix);
            return result;
        }

        protected sealed override List<IDbCommand> InsertCommands(Definitif.Test.UserAchivement obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Insert() {
                        VALUES = {
                            table["UserId"] == (obj.UserId == Id.Empty) ? DBNull.Value : obj.User,
                            table["AchivementId"] == (obj.AchivementId == Id.Empty) ? DBNull.Value : obj.Achivement,
                            table["Received"] == obj.Received,
                        }
                    })
            };
            this.InsertCommandsExtension(obj, list);
            return list;
        }
        partial void InsertCommandsExtension(Definitif.Test.UserAchivement obj, List<IDbCommand> list);

        protected sealed override List<IDbCommand> UpdateCommands(Definitif.Test.UserAchivement obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Insert() {
                        VALUES = {
                            table["Version"] == obj.Version + 1,
                            table["UserId"] == (obj.UserId == Id.Empty) ? DBNull.Value : obj.User,
                            table["AchivementId"] == (obj.AchivementId == Id.Empty) ? DBNull.Value : obj.Achivement,
                            table["Received"] == obj.Received,
                        },
                        WHERE = {
                            table["Id"] == obj.Id.Value,
                            table["Version"] == obj.Version,
                        }
                    })
            };
            this.UpdateCommandsExtension(obj, list);
            return list;
        }
        partial void UpdateCommandsExtension(Definitif.Test.UserAchivement obj, List<IDbCommand> list);

        protected sealed override List<IDbCommand> DeleteCommands(Definitif.Test.UserAchivement obj) {
            List<IDbCommand> list = new List<IDbCommand> {
                this.database.GetCommand(
                    new Delete(table) {
                        WHERE = {
                            table["Id"] == obj.Id.Value, 
                            table["Version"] == obj.Version,
                        }
                    })
            };
            this.DeleteCommandsExtension(obj, list);
            return list;
        }
        partial void DeleteCommandsExtension(Definitif.Test.UserAchivement obj, List<IDbCommand> list);

        public string FieldNameJoin(IModel model) {
            if (model is System.CodeDom.CodeNamespace.User) {
                return "UserId";
            }
            else if (model is System.CodeDom.CodeNamespace.Achivement) {
                return "AchivementId";
            }
            else throw new ArgumentException();
        }

        public string FieldNameWhere(IModel model) {
            if (model is System.CodeDom.CodeNamespace.User) {
                return "AchivementId";
            }
            else if (model is System.CodeDom.CodeNamespace.Achivement) {
                return "UserId";
            }
            else throw new ArgumentException();
        }

    }
}
